---
title:  å›¾ä¹¦å•†åŸè´­ç‰©è½¦çš„å®ç°
date: 2021-04-24 15:01:16
permalink: /pages/c97f7d/
categories:
  - <JavaWeb>ç¬”è®°
---
<Badge text="Version 3.0"/>

> âœğŸ»**å®éªŒè¦æ±‚**ï¼š
>
> a) æ•´ä¸ªè´­ç‰©è½¦ä½¿ç”¨MVCæ¨¡å¼ï¼›
>
> b) ä½¿ç”¨ServletåŠJavaBeanå®ç°æ§åˆ¶å±‚ä¸ä¸šåŠ¡é€»è¾‘å±‚çš„åˆ†ç¦»ï¼›Serveltä¸­ä¸»è¦å®Œæˆå“åº”ç”¨æˆ·è¯·æ±‚ï¼Œè°ƒç”¨æ–¹æ³•ï¼Œä¿å­˜æ•°æ®åŠæ§åˆ¶è½¬å‘ï¼›å‰©ä¸‹çš„ä¸šåŠ¡åŠæ•°æ®ç”±JavaBeanè´Ÿè´£ã€‚
>
> c) JSPè´Ÿè´£æ˜¾ç¤ºï¼Œä¸å…è®¸å‡ºç°Javaç¨‹åºç‰‡åŠè¡¨è¾¾å¼ã€‚ä½¿ç”¨JSTLåŠELè¡¨è¾¾å¼ç”šè‡³è‡ªå®šä¹‰æ ‡ç­¾è¿›è¡Œæ›¿æ¢ï¼›
>
> d) å°½å¯èƒ½çš„æé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚

<img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/larKxW.png" alt="image-20210424154231905" style="zoom: 25%;" />

<img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/2EY8VP.png" alt="image-20210424155529925" style="zoom:25%;" />

## ğŸ§ä¸‰å±‚æ¶æ„æ€è·¯

![image-20210424152431086](https://gitee.com/realsimonooo/blog-image/raw/master/uPic/hMjoSq.png)



### ğŸŒMVCè®¾è®¡æ¨¡å¼

é‡‡ç”¨MVCè®¾è®¡æ¨¡å¼ï¼Œ æ€è·¯ï¼šè§†å›¾å±‚`.jsp`é¡µé¢ â¡ï¸ æ¨¡å‹å±‚`javaBean` â¡ï¸ æ§åˆ¶å±‚`Servlet` è¿›è¡Œã€‚

![image-20210424150202823](https://gitee.com/realsimonooo/blog-image/raw/master/uPic/2E6cVy.png)



### ğŸ“ƒViewè§†å›¾é¡µé¢è®¾è®¡éƒ¨åˆ†

#### ğŸ›ï¸å•†å“å±•ç¤ºé¡µé¢ `item.jsp`

+ åˆ—è¡¨å±•ç¤ºä½¿ç”¨è¡¨æ ¼å®ç°ï¼›
+ ä½¿ç”¨JSTLæ ‡ç­¾`<c:forEach>`å¯¹`items`éå†ï¼›
+ `items`æ¥è‡ªServletä¸­çš„`request`åŸŸï¼›

```html
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<html>
<head>
    <title>ğŸ‘æ¬¢è¿å…‰ä¸´ï½</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <div class="box">
        <h1>ğŸ›å•†å“åˆ—è¡¨</h1>
        <table>
            <tr>
                <td>å•†å“ç¼–å·</td>
                <td></td>
                <td>åç§°</td>
                <td>ä»·æ ¼</td>
                <td>æ“ä½œ</td>
            </tr>
            <c:forEach var="me" items="${items}">
                <tr>
                    <td>${me.value.id}</td>
                    <td><img src="${pageContext.request.contextPath}/${me.value.img}"></td>
                    <td>${me.value.name}</td>
                    <td>${me.value.price}</td>
                    <td><a href="${pageContext.request.contextPath}/BuyServlet?id=${me.value.id}">è´­ä¹°</a> </td>
                </tr>
            </c:forEach>
        </table>
        <a href="index.jsp"><button>ğŸ è¿”å›é¦–é¡µ</button></a>
        <a href="${pageContext.request.contextPath}/cart.jsp"><button>ğŸ›’è¿›å…¥è´­ç‰©è½¦</button></a>
    </div>
</div>
</body>
</html>
```



#### ğŸ›’è´­ç‰©è½¦é¡µé¢`cart.jsp`

ä¸å•†å“å±•ç¤ºé¡µé¢åŒç†ã€‚

```html
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<html>
<head>
    <title>ğŸ›’è´­ç‰©è½¦ - xxå•†åŸ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <div class="box">
        <h1>ğŸ›’è´­ç‰©è½¦</h1>

        <c:if test="${empty(cart.itemMap)}">
            <h5 align="center">âš ï¸æ‚¨è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•å•†å“åˆ°è´­ç‰©è½¦ï¼</h5>
        </c:if>

        <c:if test="${!empty(cart.itemMap)}">
            <table>
                <tr>
                    <td>ç¼–å·</td>
                    <td>å›¾ç‰‡</td>
                    <td>åç§°</td>
                    <td>å•ä»·</td>
                    <td>æ•°é‡</td>
                    <td>å°è®¡</td>
                    <td>æ“ä½œ</td>
                </tr>
                <c:forEach items="${cart.itemMap}" var="me">
                    <tr>
                        <td>${me.key}</td>
                        <td><img src="${pageContext.request.contextPath}/${me.value.item.img}"></td>
                        <td>${me.value.item.name}</td>
                        <td>${me.value.item.price}</td>
                        <td><a href="#" onclick="return subQuantity(${me.value.count}, ${me.key})">â–</a>
                                ${me.value.count}
                            <a href="#" onclick="return addQuantity(${me.value.count}, ${me.key})">â•</a>
                        </td>
                        <td>${me.value.price}</td>
                        <td><a href="${pageContext.request.contextPath}/CartDeleteServlet?id=${me.value.item.id}">åˆ é™¤</a>
                        </td>
                    </tr>
                </c:forEach>
                <tr>
                    <td colspan="2">ğŸ’°å•†å“ä»·æ ¼åˆè®¡ï¼š${cart.price}å…ƒ</td>
                </tr>
            </table>
            <a href="${pageContext.request.contextPath}/CartClearServlet" onclick="return clearCart()">
                <button>ğŸ—‘æ¸…ç©ºè´­ç‰©è½¦</button>
            </a>
        </c:if>
        <a href="${pageContext.request.contextPath}/ShowItem">
            <button>ğŸ”™è¿”å›å•†åŸ</button>
        </a>

    </div>
</div>
</body>
</html>
```



**ä½¿ç”¨`JavaScript`è´­ç‰©è½¦å®ç°å•†å“æ•°é‡å¢å‡çš„æ“ä½œï¼š**

```js
<script type="text/javascript">
        /**
         * æ•°é‡å¢åŠ 
         * @param quantity
         * @param id
         */
        function addQuantity(quantity, id) {
            var oldValue = quantity;
            quantity++;
            window.location.href = "${pageContext.request.contextPath}/CartUpdateQuantityServlet?id=" + id + "&quantity=" + quantity + "";
        }

        /**
         * æ•°é‡å‡å°‘
         * @param quantity
         * @param id
         */
        function subQuantity(quantity, id) {
            var oldValue = quantity; 
            if (oldValue > 1) {
                quantity--;
                window.location.href = "${pageContext.request.contextPath}/CartUpdateQuantityServlet?id=" + id + "&quantity=" + quantity + "";
            } else if (oldValue = 1) {
                var c = window.confirm("å†å‡å°±è¦åˆ æ‰å•†å“å•¦ï¼ğŸ˜­");
                if (c) {
                    window.location.href = "${pageContext.request.contextPath}/CartDeleteServlet?id=" + id + "&quantity=";
                }
            }
        }

        /**
         * æ¸…ç©ºè´­ç‰©è½¦
         * @returns {boolean}
         */
        function clearCart() {
            var que = window.confirm("ğŸ›’ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿ");
            if (que) {
                return true;
            } else {
                return false;
            }
        }
    </script>
```



### ğŸ§†Model JavaBeanéƒ¨åˆ†

è®¾è®¡è´­ç‰©è½¦ã€è´­ç‰©è½¦å•†å“ã€å•†å“çš„å®ä½“ç±»ï¼›

#### å•†å“å®ä½“

```java
public class Item {
    String id; // å•†å“id
    String name; // å•†å“åç§°
    double price; // å•†å“ä»·æ ¼
    String img; // å•†å“å›¾ç‰‡

    public Item(String id, String name, String img, double price) {
        this.id = id;
        this.name = name;
        this.price = price;
        this.img = img;
    }

    public String getImg() {
        return img;
    }

    public void setImg(String img) {
        this.img = img;
    }

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public double getPrice() {
        return price;
    }

    public void setPrice(double price) {
        this.price = price;
    }
}
```



#### è´­ç‰©è½¦å®ä½“

```java
public class Cart {
    private Map<String, CartItem> itemMap = new LinkedHashMap<>();
    private double price; // è´­ç‰©è½¦æ€»ä»·

    /**
     * å°†ç”¨æˆ·é€‰æ‹©çš„å•†å“åŠ å…¥åˆ°è´­ç‰©è½¦ä¸­
     *
     * @param item ç”¨æˆ·é€‰æ‹©çš„å•†å“
     */
    public void addItem(Item item) {
        // è·å–è´­ç‰©é¡¹
        CartItem cartItem = itemMap.get(item.getId());

        // åˆ¤æ–­å­˜åœ¨
        if (cartItem == null) {
            cartItem = new CartItem();
            cartItem.setItem(item); // è®¾ç½®å•†å“ä¸ºè´­ç‰©é¡¹
            cartItem.setCount(1); // è®¾ç½®è´­ç‰©é¡¹æ•°é‡1
            itemMap.put(item.getId(), cartItem); // å°†è´­ç‰©é¡¹æ·»åŠ åˆ°è´­ç‰©è½¦
        } else {
            cartItem.setCount(cartItem.getCount() + 1);
        }
    }

    /**
     * è®¡ç®—è´­ç‰©è½¦çš„æ€»ä»·
     *
     * @return è´­ç‰©è½¦å•†å“çš„æ€»ä»·æ ¼
     */
    public double getPrice() {
        double totalPrice = 0;
        for (Map.Entry<String, CartItem> me : itemMap.entrySet()) {
            CartItem cartItem = me.getValue();
            totalPrice += cartItem.getPrice();
        }
        return totalPrice;
    }

    public Map<String, CartItem> getItemMap() {
        return itemMap;
    }

    public void setItemMap(Map<String, CartItem> itemMap) {
        this.itemMap = itemMap;
    }

    public void setPrice(double price) {
        this.price = price;
    }
}
```



#### è´­ç‰©è½¦å•†å“å®ä½“

```java
/**
 * ä»£è¡¨å½“å‰è´­ç‰©é¡¹
 * å¤„ç†è´­ä¹°ç›¸åŒå•†å“å¤šæ¬¡çš„é—®é¢˜
 */
public class CartItem extends HttpServlet {
    private Item item;
    private int count;

    private double price; // å½“å‰ç‰©å“çš„æ€»ä»·æ ¼

    /**
     * ç­‰äºæ•°é‡*ä»·æ ¼
     *
     * @return å½“å‰ç‰©å“çš„æ€»ä»·æ ¼
     */
    public double getPrice() {
        return item.getPrice() * this.count;
    }

    public Item getItem() {
        return item;
    }

    public void setItem(Item item) {
        this.item = item;
    }

    public int getCount() {
        return count;
    }

    public void setCount(int count) {
        this.count = count;
    }

    public void setPrice(double price) {
        this.price = price;
    }
}
```

#### å¼€å‘æ•°æ®åº“è®¿é—®å¯¹è±¡DAO

```java
/**
 * æ¨¡æ‹Ÿå•†å“DAO
 */
public class ItemDAO {
    /**
     * @return å­˜æ”¾å•†å“Mapçš„é›†åˆ
     */
    public Map getAll() {
        return ItemDB.getAll();
    }

    /**
     * æ ¹æ®å…³é”®å­—æŸ¥æ‰¾å•†å“
     *
     * @param id å•†å“id
     * @return å•†å“Mapé¡¹
     */
    public Item find(String id) {
        return ItemDB.getAll().get(id);
    }
}
```
æ¨¡æ‹Ÿæ•°æ®åº“å¯¼å…¥å•†å“æ•°æ®`ItemDB.java`
```java
/**
 * æ¨¡æ‹Ÿå•†å“æ•°æ®åº“å¯¼å…¥
 */
public class ItemDB {
    private static Map<String, Item> map = new LinkedHashMap<>();

    static {
        map.put("10101", new Item("10101", "Javaæ ¸å¿ƒæŠ€æœ¯", "/img/10101.jpg", 20));
        map.put("10102", new Item("10102", "Javaç»å…¸å®ä¾‹", "/img/10102.jpg", 38.5));
        map.put("10103", new Item("10103", "Java7", "/img/10103.jpg", 25));
        map.put("10104", new Item("10104", "JSP&Servlet", "/img/10104.jpg", 30));
    }

    public static Map<String, Item> getAll() {
        return map;
    }

}
```

### ğŸ®Controller Servletéƒ¨åˆ†

#### å±•ç¤ºå•†å“ `ShowItemServlet`

```java
/**
 * å®æ—¶æ›´æ–°å±•ç¤ºè´­ç‰©è½¦çš„Servlet
 */
@WebServlet(name = "ShowItemServlet", urlPatterns = "/ShowItem")
public class ShowItemServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // è°ƒç”¨Serviceçš„æ–¹æ³•è·å–å¾—åˆ°çš„å•†å“é›†åˆ
        BookstoreService bookstoreService = new BookstoreService();
        Map Items = bookstoreService.getAll();

        // å°†å•†å“å­˜æ”¾åˆ°åŸŸå¯¹è±¡ä¸­
        request.setAttribute("items", Items);

        request.getRequestDispatcher("/item.jsp").forward(request, response);

    }
}
```



#### è´­ä¹°å•†å“ `BuyServlet`

```java
/**
 * å®ç°å•†å“é¡µé¢è´­ä¹°æŒ‰é’®çš„Servlet
 */
@WebServlet(name = "BuyServlet", urlPatterns = "/BuyServlet")
public class BuyServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        doGet(request, response);
    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String id = request.getParameter("id");

        Cart cart = (Cart) request.getSession().getAttribute("cart");

        if (cart == null) {
            cart = new Cart();
            request.getSession().setAttribute("cart", cart);
        }

        BookstoreService BookstoreService = new BookstoreService();
        BookstoreService.buyItem(id, cart);

        request.getRequestDispatcher("/cart.jsp").forward(request, response);

    }
}
```

å¯¹åº”`BookstoreService`ä¸­çš„æ–¹æ³•ï¼š

```java
/**
     * å°†ç”¨æˆ·æƒ³è´­ä¹°çš„å•†å“æ·»åŠ åˆ°è´­ç‰©è½¦
     *
     * @param id   å•†å“id
     * @param cart å½“å‰è´­ç‰©è½¦
     */
    public void buyItem(String id, Cart cart) {
        Item item = itemDAO.find(id);
        cart.addItem(item);
    }
```



#### æ”¹å˜è´­ç‰©å•†å“æ•°é‡

+ **å¢å‡å’Œå‡å°‘æ•°é‡** `CartUpdateQuantityServlet`

  ```java
  /**
   * è´­ç‰©è½¦å•†å“é¡¹æ•°é‡æ›´æ–°Servlet
   */
  @WebServlet(name = "CartUpdateQuantityServlet", urlPatterns = "/CartUpdateQuantityServlet")
  public class CartUpdateQuantityServlet extends HttpServlet {
      protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
          doGet(request,response);
      }
  
      protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
          String id=request.getParameter("id");
          String quantity = request.getParameter("quantity");
  
          Cart cart = (Cart)request.getSession().getAttribute("cart");
  
          try{
              BookstoreService bookstoreService = new BookstoreService();
              bookstoreService.updateQuantity(id, cart, quantity);
  
              request.getRequestDispatcher("/cart.jsp").forward(request, response);
          } catch (Exception e){
              e.printStackTrace();
          }
      }
  }
  ```

  å¯¹åº”`BookstoreService`ä¸­çš„æ–¹æ³•ï¼š

  ```java
      /**
       * æ›´æ–°è´­ç‰©è½¦ä¸­å•†å“æ•°é‡
       *
       * @param id       å•†å“id
       * @param cart     å½“å‰è´­ç‰©è½¦
       * @param quantity æ›´æ”¹ä¸ºçš„æ•°ç›®
       */
      public void updateQuantity(String id, Cart cart, String quantity) {
          cart.getItemMap().get(id).setCount(Integer.parseInt(quantity));
      }
  ```

+ **åˆ é™¤å•†å“** `CartDeleteServlet`

  ```java
  /**
   * è´­ç‰©è½¦åˆ é™¤Servlet
   */
  @WebServlet(name = "CartDeleteServlet", urlPatterns = "/CartDeleteServlet")
  public class CartDeleteServlet extends HttpServlet {
      protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
  
      }
  
      protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
          String id = request.getParameter("id");
  
          Cart cart = (Cart)request.getSession().getAttribute("cart");
  
          try{
              BookstoreService bookstoreService = new BookstoreService();
              bookstoreService.deleteItem(id, cart);
  
              request.getRequestDispatcher("/cart.jsp").forward(request, response);
  
          }catch (Exception e){
              e.printStackTrace();
              request.setAttribute("message","åˆ é™¤å‡ºç°å¼‚å¸¸");
  
          }
      }
  }
  ```
  å¯¹åº”`BookstoreService`ä¸­çš„æ–¹æ³•ï¼š
  ```java
      /**
     * åˆ é™¤è´­ç‰©è½¦ä¸­çš„å•†å“
     *
     * @param id   å•†å“id
     * @param cart å½“å‰è´­ç‰©è½¦
     */
    public void deleteItem(String id, Cart cart) {
        cart.getItemMap().remove(id);
    }
  ```
+ **æ¸…ç©ºè´­ç‰©è½¦** `CartClearServlet`

  ```java
  /**
   * è´­ç‰©è½¦æ¸…ç©ºç±»
   */
  @WebServlet(name = "CartClearServlet", urlPatterns = "/CartClearServlet")
  public class CartClearServlet extends HttpServlet {
  
      @Override
      protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
          String id = request.getParameter("id");
          Cart cart = (Cart) request.getSession().getAttribute("cart");
  
          try {
              BookstoreService bookstoreService = new BookstoreService();
              bookstoreService.clearCart(cart);
  
              request.getRequestDispatcher("/cart.jsp").forward(request, response);
          } catch (Exception e){
              e.printStackTrace();
          }
      }
  }
  ```
  å¯¹åº”`BookstoreService`ä¸­çš„æ–¹æ³•ï¼š
  ```java
      /**
     * æ¸…ç©ºè´­ç‰©è½¦
     *
     * @param cart å½“å‰è´­ç‰©è½¦
     */
    public void clearCart(Cart cart) {
        cart.getItemMap().clear();
    }
  ```

  

  