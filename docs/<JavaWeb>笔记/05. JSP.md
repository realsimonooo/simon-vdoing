---
title:  JSP
date: 2021-04-01 19:50:56
permalink: /pages/89d504/
categories:
  - <JavaWeb>笔记
---
## `JSP` 原理

+ 浏览器访问什么资源最终都是在访问Servlet，JSP文件本质为Java  类文件。
  + JSP文件中的 `<%%>`中的Java代码不变，HTML代码会被转换为如`out.write("<html>\r\n")`。

## `JSP` 基础语法

> JSP是Java技术的应用，是Java的扩充语法。

```java
<% ... %>
<%= ... %>
<%! ... %>
```

⚠️注释方法：

```java
<!-- HTML的注释，客户端仍然会显示 -->
<%-- JSP注释，不会被客户端中源码显示--%>
```



### `JSP`表达式

作用： 输出程序的结果到客户端；

```java
<%= 变量或表达式%>
<%= new java.util.Date()%>
```



#### `JSP`脚本片段

```java
<%
    int sum = 0;
    for (int i = 0; i <= 100; i++) {
        sum += i;
    }
    out.println("sum = " + sum);
%>
```



在代码中中插入`HTML`片段

```java
<%for (int i = 0; i < 5; i++) {%>
<h1>hello,World <%=i%>
</h1>
<%}%>
```



#### `JSP`声明

```java
<%!
    static {
        System.out.println("Loading Servlet");
    }

    private int globalVal = 0;

    public void testGlobal() {
        System.out.println("进入方法testGlobal");
    }
%>
```

> ⚠️：
>
> + **JSP声明**被编译到JSP生成的Java类中；
> + 其他的JSP `<% … %>` / `<%= ... %>`代码被生成到`_jspService`方法。

#### `JSP`指令

> `JSP`指令用来设置整个`JSP`**页面相关的属性**，如网页的编码方式和脚本语言。
>
> | **指令**             | **描述**                                                    |
> | :------------------- | :---------------------------------------------------------- |
> | `<%@ page ... %>`    | 定义网页**依赖属性**，比如脚本语言、error页面、缓存需求等等 |
> | `<%@ include ... %>` | 包含其他文件                                                |
> | `<%@ taglib ... %>`  | 引入**标签库的定义**（`JSTL`标准标签库）                    |



##### `page`指令

+ 用于为容器提供当前页面的**使用说明**；
+ 一个`JSP`页面可以包含**多个**`page`指令；

```java
<%@ page attribute="value" %>
```

> 等价的`xml`格式为：
>
> `<jsp:directive.page attribute="value" />`



常见用法：

1. 导入某个包：

```java
<%@ page import 包名 %>
```

2. 自定义**错误页面**：

```java
<%@ page errorPage="..." %>
```

自定义响应码`500`错误的页面：

+ 在需要设定的jsp页面中，写`JSP`指令：

```java
<%--设定出现500错误时，跳转至的页面--%>
<%@ page errorPage="error/500.jsp" %>
```

> 自定义响应码`404`错误的页面
>
> + 在`web.xml`中配置：
>
> ```xml
> <error-page>
>     <error-code>404</error-code>
>     <location>/error/404.jsp</location>
> </error-page>
> ```
>



##### `include`指令

+ 通过`include`指令包含其它文件，文件格式可以为`.jsp`、`.html`、`.txt`格式；
+ 包含的文件会变成该`JSP`页面的一部分，被同时编译运行；

常见用法：

1. 插入头部、尾部信息文件：

```java
<%@ include file="header.jsp">
  <h1>网站主体</h1>
<%@ include file="footer.jsp">
```

​	使用`<%@ … %>`会将三个页面合为一个；

> 区分：使用`JSP`标签时：
>
> ```java
> <jsp:include page="header.jsp"/>
>     <h1>网站主体</h1>
> <jsp:include page="footer.jsp"/>
> ```
>
> ​	使用该方法将页面拼接，本质还是有三个页面。
>



##### `taglib`指令

+ JSP API允许用户自定义标签，一个自定义标签库就是自定义标签的集合；
  + 允许引入自定义标签集合的定义，包括库的定义、自定义标签。

用法：

```java
<%@ taglib uri="uri" prefix="prefixOfTag" %>
```

[➡️`JSTL标准标签库`](http://localhost:8081/pages/89d504/#jstl标准标签库)

## `JSP`内置对象及作用域

1. :star:`pageContext`;
2. :star:`Request`;
3. :star:`Response`;
4. :star:`Session`;
5. :star:`Application`; （`ServletContext`）
6. `config`; （`ServletConfig`）
7. `Out`;
8. `page`；
9. `exception` ;



+ 以`Attribute`为例：

```java
<%--存储属性--%>
<%
    // 级别从高到低
    pageContext.setAttribute("name1", "name1"); // 保存的数据只在一个页面中有效
    request.setAttribute("name2", "name2"); // 保存的数据只在一次请求中有效
    session.setAttribute("name3", "name3"); // 保存的数据只在一次回话中有效（从打开浏览器到关闭浏览器）
    application.setAttribute("name4", "name4"); // 保存的数据在服务器中有效（从打开服务器到关闭服务器）
%>
```

```java
<%--取出属性--%>
<%
    // 通过寻找findAttribute()
    // 寻找：从低级别到高级别
    // 页面->请求->会话->服务器
    // page<request<session<application
    String name1 = (String) pageContext.findAttribute("name1");
    String name2 = (String) pageContext.findAttribute("name2");
    String name3 = (String) pageContext.findAttribute("name3");
    String name4 = (String) pageContext.findAttribute("name4");
    String name5 = (String) pageContext.findAttribute("name5"); // 不存在
%>
```

```java
<%--使用EL表达式${}输出--%>

<h3>${name1}</h3>
<h3>${name2}</h3>
<h3>${name3}</h3>
<h3>${name4}</h3>

<%--不存在时：--%>
<%--使用EL表达式不会显示null--%>
<h3>${name5}</h3>
<%--使用<%=%>会显示null --%>
<%=name5%>

```



+ 以`forward`转发为例：

  ```java
  <%
  		// 在页面中转发
      pageContext.forward("/index.jsp");
      // 同理:   request.getRequestDispatcher("/index.jsp").forward(request, response);
  %>
  ```

  

::: tip 总结

+ `request`: 请求，客户端向服务器发送请求，产生的数据，使用完后不保存；
  + 作用域可以通过`pageContext.forward(“…”)`转发
+ `session`: 回话产生的数据，还会保留一定的市场；（登录、购物车应用等）
+ `application`：产生的数据，共给**多个**用户使用

:::





## 标签

> + `JSP`标签
> + `JSTL`标签
> + `EL`表达式：`${}`
>   + 获取数据；
>   + 执行运算；
>   + 获取web开发常用的对象；



### `JSP`标签

常见应用

+ 拼接头部、脚步页面可用：

  ```java
  <jsp:include file="" />
  ```

+ 转发页面

  ```java
  <jsp:forward page="..." />
  ```

+ 使页面转发时携带参数以及存储值

  ```java
  <%-- 1.jsp中 --%>
  <jsp:forward page="2.jsp">
  	<jsp:param name="test" value="test"></jsp:param>
  </jsp:forward>
```
  
  ```java
  <%-- 2.jsp中 --%>
  <%-- 取出参数--%>
  <%=request.getParameter("test")%>
  ```
  
  

### `JSTL标准标签库`

:book:：[<配置、安装包步骤>](/pages/9ff2a0/#jstl库的安装)

> JSP标准标签库（JSTL）是一个JSP标签集合，它封装了JSP应用的通用核心功能。
>
> JSTL支持通用的、结构化的任务，比如迭代，条件判断，XML文档操作，国际化标签，SQL标签。 除了这些，它还提供了一个框架来使用集成JSTL的自定义标签。

自定义的标签，提供Java的功能；

+ **核心标签：**

  引入头部：

```java
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
```

​	用法：

| 标签                                                         | 描述                                                         |
| :----------------------------------------------------------- | :----------------------------------------------------------- |
| [`<c:out>`](https://www.runoob.com/jsp/jstl-core-out-tag.html) | **显示数据**，就像`<%= … >`                                  |
| [`c:set`](https://www.runoob.com/jsp/jstl-core-set-tag.html) | **保存数据**                                                 |
| [`c:remove`](https://www.runoob.com/jsp/jstl-core-remove-tag.html) | **删除数据**                                                 |
| [`c:catch`](https://www.runoob.com/jsp/jstl-core-catch-tag.html) | 处理**异常**，储存错误信息                                   |
| :star:[`c:if`](https://www.runoob.com/jsp/jstl-core-if-tag.html) | 一般程序中用的`if`                                           |
| [`c:choose`](https://www.runoob.com/jsp/jstl-core-choose-tag.html) | 本身只当做`c:when`和`c:otherwise`的父标签                    |
| [`c:when`](https://www.runoob.com/jsp/jstl-core-choose-tag.html) | `c:choose`的子标签，用来**判断条件是否成立**                 |
| [`c:otherwise`](https://www.runoob.com/jsp/jstl-core-choose-tag.html) | `c:choose`的子标签，接在`c:when`标签后，当`c:when`标签判断为`false`时被执行 |
| [`c:import`](https://www.runoob.com/jsp/jstl-core-import-tag.html) | 检索一个绝对或相对 URL，然后将其内容暴露给页面               |
| :star:[`c:forEach`](https://www.runoob.com/jsp/jstl-core-foreach-tag.html) | 基础**迭代**标签，接受**多种集合类型**                       |
| [`c:forTokens`](https://www.runoob.com/jsp/jstl-core-foreach-tag.html) | 根据指定的分隔符来分隔内容并迭代输出                         |
| :star:[`param`](https://www.runoob.com/jsp/jstl-core-param-tag.html) | 用来给**包含或重定向**的页面**传递参数**                     |
| [`c:redirect`](https://www.runoob.com/jsp/jstl-core-redirect-tag.html) | **重定向**                                                   |
| [`c:url`](https://www.runoob.com/jsp/jstl-core-url-tag.html) | 使用可选的查询参数来创造一个URL                              |