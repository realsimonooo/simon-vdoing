---
title:  Servlet
date: 2021-03-18 16:25:40
permalink: /pages/8a5338/
categories: 
  - <JavaWeb>笔记
---

# 02. Servlet



## 第一个Servlet程序



```java
public class testServlet extends HttpServlet {
    /**
     * 重新定义doGet
     * @param request
     * @param response
     * @throws ServletException
     * @throws IOException
     */
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        response.setContentType("text/html;charset=UTF-8"); // 设定响应内容类型

        String name = request.getParameter("name"); // 请求获得参数
        PrintWriter out = response.getWriter(); // 取得相应输出对象
        out.print("<!DOCTYPE html>");
        out.print("<html>");
        out.print("<head>");
        out.print("<title>Hello</title>");
        out.print("</head>");
        out.print("<body>");
        out.printf("<h1> Hello! %s!%n</h1>" , name);
        out.print("</body>");
        out.print("</html>");
    }
}
```





## 初始化Servlet的两种方法

1. `@WebServlet` 注释法

   ```java
   @WebServlet(name="helloServlet",urlPatterns={"/hello"})
   ```
   
`urlPatterns`对应映射模式访问地址：`localhost:8080/ex03/hello` 
   

   
2. 配置文件`web.xml`

```xml
<web-app>  
    <servlet>           
     <servlet-name>Servlet</servlet-name>          
    <servlet-class>com.hello.Servlet</servlet-class> 
    </servlet>
    <servlet-mapping>           
        <servlet-name>Servlet</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>
</web-app>
```



+ `@WebServlet`中的`name`对应`web.xml`中的`<servlet-name>`，当名称相同，`web.xml`会覆盖`@WebServlet`中的参数


## Servlet生命周期

 ![image-20210408174914938](https://gitee.com/realsimonooo/blog-image/raw/master/uPic/iSIpMT.png)

+ `init()` 第一次被请求加载时，完成初始化工作，传递Web应用程序(`web.xml`)的配置信息；

+ `service()`方法：响应**客户的请求**；

  + 根据`service`的定义判断HTTP的请求方式，分别调用`doGet()`,`doPost()`等方法；

    > `service()`对**请求方法的顺序**：
    >
    > 1. `doGet()`
    > 2. `doHead()`
    > 3. `doPost()`
    > 4. `doPut()`

  + `doGet()`,`doPost()`方法直接继承`service()`方法：

    通过重写这两个方法来响应用户的请求，增强响应的灵活性，降低服务器负担；

+ `destroy()`方法：当一个Servlet实例应该从服务器中移除时使用，释放其使用的资源。

![image-20210408174931943](https://gitee.com/realsimonooo/blog-image/raw/master/uPic/q9JZaZ.png)

## Servlet请求的分发








## Web应用的文件结构

```
\[web应用名称]：web应用程序的所有文件
\[web应用名称]\WEB-INF:部署描述符文件web.xml及以下三个文件夹
	\[web应用名称]\WEB-INF\classes:存放Servlet和javaBean相关的类文件
	\[web应用名称]\WEB-INF\lib:所需的类包(JAR文件)
	\[web应用名称]\WEB-INF\tags:标签文件
	\[web应用名称]\WEB-INF\web.xml:web应用程序的配置和部署信息
```



## `ServletContext`



## `Response`与`Request`

+ 获取客户端请求过来的参数，使用`HttpServletRequest`；
+ 向客户端响应一些信息，使用`HttpServletResponse`；



### `HttpServletResponse`

#### 方法分类

+ 负责向浏览器发送数据的方法；

+ 负责向浏览器发送响应头的方法；

+ 常量设置响应状态码；

  > 200：请求响应成功；
  >
  > 3**：请求重定向；
  >
  > 4**：资源不存在
  >
  > ​	404：找不到资源
  >
  > 5**：服务器代码出错
  >
  > ​	502：网关出错

#### 应用

+ 向浏览器输出消息；

+ 下载文件实例： 

  ```java
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
          //  获取文件路径；
          String realPath = "***/10.jpg"; // 文件绝对路径
          System.out.println("获取的下载文件路径" + realPath);
          //  确定下载的文件名；
          String filename = realPath.substring(realPath.lastIndexOf("//") + 1); // 截取地址斜杆后的文件名
          //  设置浏览器支持下载文件
          resp.setHeader("Content-disposition", "attachment;filename" + filename);
    			// 文件名为中文
          // resp.setHeader("Content-disposition", "attachment;filename" + URLEncoder.encode(filename));
    
          //  获取下载文件的输入流；
          FileInputStream in = new FileInputStream(realPath);
          //  创建缓冲区；
          int len = 0;
          byte[] buffer = new byte[1024];
          //  获取`OutputStream`对象；
          ServletOutputStream out = resp.getOutputStream();
          //  将`FileOutputStream`流写入到`buffer`缓冲区；
          //  使用`OutputStream`将缓冲区的数据输出到客户端；
          while ((len = in.read(buffer)) > 0) {
              out.write(buffer, 0, len);
          }
          // 关闭输入输出流
          in.close();
          out.close();
      }
  ```

  

### `HttpServletRequest`

