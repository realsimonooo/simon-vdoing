---
title: 处理机调度
date: 2021-04-07 20:59:39
permalink: /pages/c85d6a/
categories:
  - <操作系统>笔记
---
## 调度基本概念

### CPU调度

+ CPU调度：进程调度程序按照一定的策略，**动态地将CPU分配给某个进程**，并使之执行；

  当CPU变得空闲时，操作系统就必须从就绪的队列中选择一个进程来执行；

+ 目的： 使得CPU的资源利用率**最高**；

  + 进程执行由**CPU执行与I/O等待周期**组成；



### 系统调度分4级

+ **作业调度；**
+ **交换调度；**
+ **进程调度；**
+ **线程调度；**



### 调度的常用术语

+ CPU利用率：
+ 吞吐率：指在给定的时间内，一个计算机系统所完成的**总工作量**。
+ 吞吐量：单位时间内，完成的**进程**；

+ 🌟周转时间： 指一个<mark>作业</mark>**提交给计算机系统后**，到该作业的**结果返回给用户**所需要的时间。（运行进程所花费的时间）
+ 🌟响应时间：指用户向计算机**发出一个<mark>命令</mark>**，到计算机把相应的**执行结果返回**给用户所需要的时间。（从提交清酒到产生第一个响应的时间）
+ 🌟等待时间：在**就绪队列**中**等待**所花费的时间；



## 作业调度

### 作业调度功能

+ **记录**系统中作业的状况（建立JCB）；
+ 从**后备作业**队列中挑选一批作业**进入执行**状态；
+ 为被选中的作业**分配资源**、**建立进程**；
+ 作业执行结束后，**释放**所占用的**资源**；



### 作业调度目标

根据不同的目标，会有不同的**调度算法**；

+ 对所有的作业**公平合理**；
+ 有较高的**利用率**；
+ 每天执行尽可能多的作业；
+ 响应时间快；



## 作业调度的衡量

+ 🌟作业`i`的<mark>周转时间</mark>：$T~i~=T~ei~-T~si~$；

  （$Tei$为作业`i`的**完成时间**，$Tsi$为作业的**提交时间**）

+ 🌟<mark>平均周转时间</mark>：<img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/1Tx0ZP.png" alt="image-20210408161709119" style="zoom: 25%;" />

+ 🌟另作业`i`的周转时间：$Ti=Twi+Tri$

  （$Twi$为作业的**等待时间**（**从后备状态到执行状态**，不包括作业进入执行状态后的时间））

  说明改作业在系统内停留的时间，包括**等待时间**和**执行时间**两部分；



## 进程调度

### 进程调度功能

+ 记录系统中**所有进程**的执行状况；
+ 选择**占有处理机**的进程；
+ 进行**进程上下文切换**；

### 进程调度时机

+ 在进程**执行完毕**，或进入**睡眠等待状态**；
+ **执行过程**中，
  + 进程调用了`P,V`原语；
  + 进程提出了I/O请求；
+ **分时系统**中，**时间片**已经**用完**；
+ 系统进程执行完毕，**调度用户进程**时；
+ 就绪队列中某**进程优先权高**于当前执行的进程；



### 进程上下文切换

包括4个步骤：

+ **决定**是否做上下文切换；
+ **保存**当前执行的进程上下文；
+ 采用合理的**调度算法**，选择一个处于**就绪状态**的进程；
+ **恢复**所选进程的上下文，将控制权交给所选进程；



### 进程调度性能评价

进程调度性能的衡量是操作系统设计的一个**重要指标**：

+ 定性： 调度的**可靠性、简洁性**；
+ 定量：**CPU利用率**、进程的**等待/执行率**；
+ 方法： 一般采用模拟或者测试系统响应时间的方法；



## 调度算法

::: tip 计算

+ :star:$ T周转时间 =T完成时间-T到达时间$
+  $T带权周转时间 = T周转时间  / T运行时间$
+ :star:$Twi(等待时间)=T周转时间-T运行时间$

:::

### 先来先服务调度 / FCFS

+ 按照**到达的先后顺序**调度，实际上是等待的时间越久越优先得到服务；

  | 思想          | 公平的角度（排队买东西）                                     |
  | ------------- | ------------------------------------------------------------ |
  | 作业/进程调度 | 用于作业调度时，考虑的是哪个作业先到达后备队列；用于进程调度时，考虑的是哪个进程先到达就绪队列； |
  | 抢占/非抢占性 | 非抢占性                                                     |
  | 优缺点        | 优点：公平，算法实现简单<br>缺点：当进程之间的**处理时间**较大时，采用FCFS策略的<mark>**平均等待时间较长**</mark>，对短作业造成不公平； |
  | 产生饥饿      | 不会                                                         |

  



### 最短作业优先调度 / SJF

+ 最短的作业优先得到服务（最短指的是要求服务时间最短）；

+ 追求最少的**平均等待时间**，最少的平均周转时间、最少的平均带权周转时间；

  + 使用两种方法：

    + 非抢占性，<mark>**一旦**一个进程**开始执行**，**就需完成**该次任务</mark>；（每次调度时选择当前已经到达且运行时间最短的作业/进程）

    + 抢占性，如果新来的进程<mark>**CPU区间段**比当前进程的时间段**小**，则**优先选择新进程**</mark>。*（**SRTF**，Shorest Remaining Time First）*

      > 每当有进程加入就绪队列改变时就需要调度，:star:如果新到达的进程**剩余时间**比当前运行进程的**剩余时间**<mark>更短</mark>，则由新的进程抢占处理机，当前运行进程重新回到就绪队列；

  + 决定**下一个**CPU区间的长度：

    + 用**前一个**CPU区间的长度**估计**下一个CPU区间的长度；

      <img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/v0jHf9.png" alt="image-20210408185423077" style="zoom:33%;" /><img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/JZFhVS.png" alt="image-20210408185548649" style="zoom: 33%;" />





### 优先权调度

+ 每个进程都有**优先权**；
  + 具有**最高优先权**的进程分配给CPU；
+ **最短作业优先调度**SJF是优先权调度的特例。
  + 优先权为下一个CPU区间的倒数。➡️ CPU区间越大，优先权越小；
+ 影响：
  + 导致问题： **饥饿**，低优先权的进程可能永远不会运行（∞无穷阻塞）；
  + 解决方案：老化，逐渐**增加**在系统中**等待时间长**的进程的**优先权**；

### 轮转法 / RR

+ 专门为**分时系统**设计：
  + 每个进程的到一个较小的时间片（*time quantum*），时间片通常为$10ms～100ms$；
  + 系统为**每个进程分配若干个时间片**，被调度的进程运行完时间片后，系统就发生调度；
  + 如果有$n$个进程，时间片为$q$，那么**每个进程**会得到$1/n$**的CPU时间**，每个长度**不超过**$1/q$的时间单元；每个进程必须**等待CPU**的时间**不会超过**$(n-1)q$个时间单元，直到下一个时间片为止。
+ 有两种情况：
  + CPU区间 **小于** 时间片；
  + CPU区间 **大于** 时间片；