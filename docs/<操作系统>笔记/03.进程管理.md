---
title: 进程管理
date: 2021-03-19 13:15:39
permalink: /pages/49dcb1/
categories:
  - <操作系统>笔记
---


## :one:进程



### 程序

程序：是一个在⌚️时间上严格按照先后次序操作的指令序列；

​	静态型：是一个静态的概念；

#### 程序的顺序执行

单道程序设计时程序执行顺序的特点：

+ 顺序性：严格程序规定的状态转移；
+ 封闭性：由初始条件决定，**不受外界影响**；
+ 可再现性：最终的结果与执行速度无关，只要初始条件相同，则无变化；

```pascal
	Repeat  IR ← M ［PC］
		 PC ← PC +1
		〈 Execute (instruction in IR)〉
	Until CPU halt
```

多道程序系统中的程序执行的特点：

+ 独立性：逻辑上独立，每道程序；
+ 随机性：输入与程序**开始的时间**是随机的；
+ 资源共享性：硬件与软件资源共享；

#### 程序并发

+ 为了<mark>增强计算机的处理能力和提供资源利用率</mark>所设计的一种同时操作技术；
+ 影响：
  + 优点：⬆️提高了**资源的利用率**；
  + 缺点：必然导致了**资源共享和竞争**，从而改变了程序的**执行速度**。
  + 如果并发程序不按照特定的规则和方法进行资源共享和竞争，其执行结果将不可避免失去**封闭性和可再现性**。

### 进程的概念

+ 进程指：

  + <mark>一个被**调入内存正在执行**的程序</mark>；
  + 一个具有**独立功能**的程序对**某个数据集**在**CPU处理器上**的执行过程。

+ 进程包括：

  + 代码段；
  + 堆栈段；
  + 数据段；

+ 🌟<mark>**进程的特点：**</mark>

  + **动态性；**
  + **并发性；**
  + **独立性；**
  + **异步性；**

  

### 进程和程序的区别

| 进程                                                   | 程序                  |
| ------------------------------------------------------ | --------------------- |
| 动态                                                   | 静态                  |
| 并发性                                                 | 🈚️没有并发性           |
| <mark>**是竞争系统资源的基本单位**</mark>              | 🈚️不具有系统资源竞争性 |
| **不同进程可以包含同一个程序**，程序对应的数据集不同。 | 可以有**多个进程**    |



### 进程和作业的区别

| 进程                                                         | 作业                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 具有独立功能的<mark>**程序**</mark>对某个数据集在CPU处理器上的<mark>**执行过程**</mark> | 用户需要计算机完成某项任务时要求计算机<mark>**所做工作的集合**</mark> |
| **是执行任务的执行实体**                                     | 提交任务的**任务实体**                                       |
|                                                              | <mark>一个作业可以由**多个进程**组成</mark>                  |

### 进程控制块 / PCB

+ 进程控制块<mark>**包含与特定程序相关的信息**</mark>：

  > 进程状态、进程号、程序计数器、CPU寄存器、CPU调度信息、内存管理信息、记账信息、I/O状态信息；
  1. **描述信息**：

     > 1. 进程名或进程标识号；
     > 2. 用户名或用户标识号；
     > 3. 家族关系；
    
  2. **控制信息：**

     > 1. **进程当前状态**：初始态、就绪态、执行态、等待状态、终止状态；
     >2. **进程优先级**：进程优先级是选取**进程占有处理机的重要依据**：a. 占有CPU时间 b. 进程优先级偏移 c. 占据内存时间等；
     > 3. 程序开始地址；
     >4. 各种计时信息；
     > 5. 通信信息；

  4. **资源管理信息**

     >1. 占用**内存大小**及其管理用**数据结构指针**；
     >2. 在某些复杂系统中，还有**对换或覆盖用的有关信息**，如对换程序段长度，对换外存地址等；
     >3. 共享程序段**大小及起始地址**；
     >4. 输入输出设备的设备号，所要传送的数据长度、缓冲区地址、缓冲区长度及所用设备的有关数据结构指针等；
     >5. 指向文件系统的指针及有关标识等；
     
  4. **CPU现场保护结构**
  
     >  存储退出执行时的**进程现场数据**（或称**进程上下文**）；
  
+ <mark>🌟：**进程控制块是系统感知进程存在的唯一实体。**</mark>


### 进程上下文

+ 是**进城执行活动全过程**的静态描述；

![image-20210407193212501](https://gitee.com/realsimonooo/blog-image/raw/master/uPic/KAneXh.png)

+ **进程上下文的切换：**

  + 发生在**不同的进程之间**而不是同一个进程内；

  + 进程切换过程设计3个部分；

    > 1. 保存被切换进程的正文部分（当前状态）至存储区，例如进程的PCB；
    > 2. 进程中有关调度和资源分配程序执行，并选取新的进程；
    > 3. 被选中进程的原来被保存的正文部分从存储区取出，送至有关寄存器和堆栈，激活被选中进程执行；

  <img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/fO5Wbq.png" alt="image-20210407193244361" style="zoom:50%;" />

### 进程空间与大小

![image-20210407193809462](https://gitee.com/realsimonooo/blog-image/raw/master/uPic/UCfLkx.png)

+ 进程空间：任一进程都有自己的地址空间；

  > 程序的<mark>**执行都在进程空间内进行**</mark>。
  >
  > 用户程序、进程和各种控制表格等都按照一定的结构排列在进程空间中；
  >
  > 在UNIX及Linux等操作系统中，进程空间被划分为用户空间和系统空间；➡️被划分两大部分后，**用户程序在用户空间内执行，操作系统内核程序则在系统空间内执行**；
  >
  > ➡️为了避免访问出错，计算机系统通过程序状态寄存器等设置不同的执行模式，用户模式和系统模式（又称用户态、系统态）；

+ 进程空间的大小： <mark>只与处理机的位数有关</mark>。

  + **进程的大小就是进程空间的大小**；

  > 一个16位的长处理机的进程空间大小为2^16^，32位的长处理机的进程空间为2^32^；

## :two:进程状态

### 进程状态转换

<img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/tEwOvo.png" alt="image-20210407194514909" style="zoom: 33%;" />

+ **就绪**： 已经得到**除CPU**之外的资源，只要调度得到处理机就可立刻执行；
+ 执行：任何时刻**处于执行状态的进程只能有一个**；
+ 等待：因等待某个时间发生而放弃处理机进入等待状态；



## :three:进程调度

+ 调度队列 / queues：
  + 作业队列；
  + 就绪队列；
  + 设备队列；

+ 进程调度程序：
  + 长期调度程序
  + 短期调度程序
  + 中期调度程序

## :four:进程控制

+ 系统使用一些具有特定功能的程序段来**创建、撤销进程**并完成**进程各状态间的转换**，从而达到：
  + 🌟多进程的**高效率并发和协调**；
  + 🌟实现**资源共享**；



### 原语

+ 把系统态执行的**某些特定功能程序段**称为原语；
+ 分为两类：
  + 机器指令级，特点是执行期间<mark>**不允许中断**</mark>；在操作系统中是不可分割的基本单位；
  + 功能级，特点是作为原语的程序段<mark>**不允许并发执行**</mark>；

+ 作用：通常把**进程控制用**的程序段作为原语；
  + 进程控制原语🈶️：
    + 创建；
    + 撤销；
    + 阻塞；
    + 唤醒；

### 进程的创建

+ 由系统程序模块**统一创建**，例如批处理系统；

+ 创建方式：系统调用或者父进程创建子进程，以此形成进程树🌲； 

  > 系统创建的进程之间是平等的；
  >
  > 父进程与子进程之间存在隶属关系，构成树形结构的家族关系，属于某个家族的一个进程可以**继承其父进程所拥有的资源**（限制子进程只能使用父进程资源子集）；父进程与子进程共享所有资源；父子进程共享初始化资源；

+ 两种创建方式都需要调用**创建原语**来实现；
+ 创建原语的实现过程：

<img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/5aXTFG.png" alt="image-20210407202433767" style="zoom: 50%;" />

### 进程的撤销

+ 导致进程被撤销的情况：
  1. 进程已完成所要求的功能而**正常终止**；
  2. 由于某种错误**非正常终止**；
  3. 祖先进程要求撤销某个子进程；

+ 被撤销的进程，必须释放它所占用的各种资源和PCB结构，以利于资源的有效利用；
+ 撤销原语的实现过程：

<img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/VQqqUD.png" alt="image-20210407203638949" style="zoom:50%;" />

### 进程的阻塞

+ 阻塞原语：实现进程的**执行状态➡️到到等待状态**；

+ 情况： 一个进程期待某一事件发生，但**发生条件不具备**时，被该进程自己调用阻塞原语安来阻塞自己；

+ 阻塞原语的实现过程：

  <img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/Ce7GMM.png" alt="image-20210407204022095" style="zoom:50%;" />

### 进程的唤醒

+ 在等待队列中的进程所等待的时间发生时，**等待该事件的所有进程**都被唤醒；

+ 唤醒一个进程的**两种方式**：

  + 由系统进程唤醒；

  + 由事件发生进程进程唤醒；

    > 处于阻塞状态的进程不能自己唤醒自己（❓）；

+ 唤醒原语的实现过程：

  <img src="https://gitee.com/realsimonooo/blog-image/raw/master/uPic/YB465i.png" alt="image-20210407204452510" style="zoom:50%;" />



## :five:线程

### 线程的概念

+ 线程：<mark> 🌟是一个**进程内**的基本调度单位</mark>，也称轻权进程；线程既可以由操作系统内核调度，也可以由用户程序控制；

+ 引入线程目的：

  ⬆️提高系统执行效率，

  ⬇️减少处理机空转时间和调度切换时间，便于系统管理；

+ 线程的**适用范围**：

  + 服务器中的文件管理或者通信控制；（⬇️可以减少**内存开销**）
  + 前后台处理；（⬇️减少**处理机切换时间**⬆️提高执行速度）
  + 异步处理；（程序中两部分如果没有执行的顺序规定，则🉑️可以使用**线程执行**）



### 多线程系统中进程和线程的关系

![image-20210407204843517](https://gitee.com/realsimonooo/blog-image/raw/master/uPic/nraMLJ.png)

### 线程和进程的区别

| 进程                       | 线程                                                |
| -------------------------- | --------------------------------------------------- |
| 程序独立资源分配的基本单位 | CPU执行的基本单位                                   |
| 🈶️独立地址空间              | <mark>共享</mark>统一地址空间；<br>与进程共享资源； |
| 调度开销较大➕              | 调度开销较小➖                                       |

### 线程分类

| 用户线程                                                 | 系统线程                                                     |
| -------------------------------------------------------- | ------------------------------------------------------------ |
| 用户程序完成                                             | 操作系统内核                                                 |
| 系统开销小                                               | 小于进程开销，大于用户线程开销                               |
| 上下文切换在用户栈、用户寄存器之间进行，不涉及处理机状态 | 可以调度到一个处理机上并发运行，也可以在不同的处理机上并发运行 |
| 会被阻塞或者处于等待状态                                 | 不会被阻塞或者处于等待状态                                   |

 



## :six:进程通信

### 分类 

1. **主从式**

   + 主进程可以自由使用从进程的资源；
   + 从进程的动作收到主进程的限制；
   + 主进程和从进程关系固定；

   应用： 终端控制进程、终端进程；

2. **会话式**

   + 使用进程提供的服务时，必须要得到**许可**；
   + 服务进程根据使用进程的要求提供服务，**单控制权**属于服务进程本身；
   + 使用进程和服务进程**关系固定**；

   应用： 用户进程、磁盘管理

3. **消息或邮箱机制**

   + 只要存在**空缓存区**或者**邮箱**，发送进程就可以**发送信息**；
   + 发送进程和接受进程**没有直接的关系**；
     + 之间存在缓冲区或邮箱用来**存放被传输的信息**；

4. **共享内存机制**

   + 共享内存方式 不要求 **数据移动**；
   + 需要互相交互的信息的进程通过对同一**共享数据区**的操作来达到互相通信目的；



### 消息缓冲机制

消息缓冲机制使用的缓冲区是**公用缓冲区**，使用消息缓冲机制传送数据时，**通信进程**应该满足条件：

+ 进程对缓冲区的操作 **必须互斥**；

+ 当缓冲区无消息存在时，**接受进程不能接受到任何消息**；

  > 设公用信号量`mutex`， 接受进程私用信号量`SM`，消息`m`： 
  >
  > 1.  发送信息
  >
  >    ```
  >    Send(m):
  >      Begin
  >      向系统申请一个消息缓冲区
  >      P(mutex)
  >      	# 将消息m发送到新申请的消息缓冲区
  >      V(mutex)
  >      V(SM)
  >    ```
  >
  > 2. 接受信息
  >
  >    ```
  >    Receive(m):
  >      Begin
  >      P(SM)
  >      P(mutex)
  >      	# 将消息m从缓冲区复制到接收区并释放缓冲区
  >      V(mutex)
  >    ```

### 邮箱通信

对于一个发送进程和一个接收进程使用的邮箱，进程间通信应该满足条件：

+ 发送进程发送消息时，**邮箱中至少有一个存储消息的单元**；

+ 接收进程接收信息时，**邮箱中至少有一个消息存在**；

  ![image-20210424231039437](https://gitee.com/realsimonooo/blog-image/raw/master/uPic/5pLHwz.png)



### 管道 / Pipe

![image-20210424231149389](https://gitee.com/realsimonooo/blog-image/raw/master/uPic/iupt4l.png)

管道逻辑上是管道文件，物理上由文件系统的高速缓冲区构成；

> Unix系统从System V开始，提供有名管道和无名管道两种数据通信方式；
>
> 无名管道为建立管道的进程及其子进程提供一条以**比特流方式传送**消息的通信管道；

```c
int main()
{
	int x,fd[2];
	char buf[30],s[30];
	Pipe(fd);
 	while((x=fork())==－1);//创建子进程失败，原地循环
 	if(x==0)
	{ 
    	sprintf(buf,”子进程写信息到父进程”);
 			write(fd[1],buf,30); exit(0);
  } else {	 
    	wait(0); 
    	read(fd[0],s,30);printf(“%s”,s);
  }
}
```



## :seven:🔒死锁

### 定义

当多个进程因为**竞争资源**而造成的一种僵局，没有外力作用下，这些进程将永远不能继续向前推进。

### 起因

+ 并发进程的资源竞争；
+ 进程的推进顺序不正确（不当）；

### 产生的必要条件

+ **互斥条件**： 资源的排他性；
+ **不剥夺条件**：进程对获得的资源在没有使用完毕之前，其它进程不可以剥夺使用权力；
+ **部分分配条件**：进程每次申请新的资源时，同时还要占用已经分配的资源；
+ **环路条件**： 存在**♻️进程循环链**，链中的每个进程已经获得的资源同时被下一个进程申请；

### 排除方法

+ :star:**死锁的预防**:

  + **一次性分配法**
  + 资源顺序分配法
  + 先释放资源，后申请资源

+ :star:**死锁的避免**

  + **动态预防**

    > 系统根据某种算法在动态分配资源时，预测出死锁发生的可能性，并且加以预防；

  + **银行家算法**

+ :star:**死锁的检测**

  + **资源分配静态图法**：给定的**进程—资源图**进行化简；

+ :star:**死锁的解除**

  + 剥夺资源；
  + 撤销资源；



### 银行家算法

操作系统按照银行家指定的规则，为进程分配资源；

​	当进程首次申请资源时，要测试该进程对资源的最大需求量；

​	如果系统现存的资源满足它的最大需求量，则按照当前的申请量分配资源，否则推迟分配。