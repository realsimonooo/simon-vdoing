---
title: SQL语言
date: 2021-04-14 20:09:06
permalink: /pages/af318a/
categories:
  - <数据库原理与应用>笔记
---



## :one:数据定义



### 基本表的定义

```sql
CREATE TABLE <表名>
	( 约束条件 );
```



#### 数据类型



+ `NULL`是特殊值，表示缺失的值，该值可能存在或者不存在；

+ 对于`char`和`varchar`
  + `char(n)`：系统会在字符串补足空格，使其达到`n`个字符；
  + `varchar(n)`：不会在字符串后补空格，属性值长度即为输入字符数；



#### 完整性约束

+ 存入数据字典，当操作表中的数据是由DBMS根据数据字典中的信息自动检查该操作是否违背这些完整性约束条件。

##### 实体完整性定义

通过在`CREATE TABLE`时用`PRIMARY KEY`约束；

+ 用于约束:key:主键，保证主键的**唯一性和非空性**；
+ 可作列级约束条件，也可定义为表级约束条件（视主键是由单属性还是多属性构成决定）



##### 参照完整性定义

通过在`CREATE TABLE`时：

```sql
FOREIGN KEY(<外键>) REFERENCES <被参照表名>(<与外键对应的主键名>)
```

+ 将两个表中的相应元**组联系起**来，是两个关系表之间联系的体现；
+ 当被参照表和参照表进行**更新**操作是有可能会**破坏参照完整性**；



##### 用户定义完整性

在`CREATE TABLE`中根据应用要求，定义属性以及元组以上的约束；当插入或修改数据时，RDBMS会根据约束条件进行执行；

+ `NOT NULL` ：不允许属性值**为空**；

  对关系的**主属性**必须限定为`NOT NULL`，以满足实体完整性；

+ `NULL`：允许属性值为空；（当属性没有显示声明，则默认为`NULL`）



+ `UNIQUE`：**唯一性**约束，属性中不允许出现重复的属性值；

+ `DEFAULT`：**默认值**约束。一些属性列可以讲**使用频率高的**属性定义为`DEFAULT`约束中的默认值，**减少输入的工作量**；

+ `CHECK`：**检查**约束，限定属性的取值；

  例如：**限定性别`SEX`的取值必须为`男`和`女`中的一个：**

  ```sql
  SEX CHAR(2), CHECK(SEX IN('男', '女'));
  ```

  **保证分数`GRADE`的取值范围：**

  ```sql
  CHECK(GRADE BETWEEN 0.0 AND 100.0)
  ```

  

### 基本表的修改

修改已经创建好的表；



+ **增加列或者表的约束规则**：

  例如：**在学生关系表`S`中补充定义`SNO`为:key:主键：**

  ```sql
  ALTER TABLE S ADD PRIMARY KEY(SNO)
  ```

  增加列：**在学生表`S`中增加一列学生所在系`SD`：**

  ```sql
  ALTER TABLE S ADD SD CHAR(16);
  ```



+ **删除原有列或约束规则**

  例如：**删除学生基表`S`中的性别`SEX`属性列：**

  ```sql
  ALTER TABLE S DROP COLUMN SEX:
  ```

  

+ **修改原有列的类型**

  例如：**将学生基表`S`中的学生姓名`SN`长度修改为`12`：**

  ```sql
  ALTER TABLE S ALTER COLUMN SN CHAR(12);
  ```



### 基本表的删除

+ 例如：删除表`S`

  ```sql
  DROP TABLE S;
  ```



## :two:数据查询

语句格式：

```sql
SELECT <目标列表达式>
FROM <表名或视图名>
[WHERE <元组选择表达式>]
[GROUP BY <属性列名> [HAVING <组选择条件表达式>]]
[ORDER BY <目标列名>];
```



### 单表查询

+ **显示查询结果**：

  `<目标列表达式>` ：不仅仅可以是表中属性列名，也可以是与属性列有关的表达式（经过一定计算输出结果，包括函数、字符串常量）

  例如：**查询学生关系表`S`：**

  ```sql
  SELECT * FROM S; / 取出S表所有数据的情况
  ```

  :star:`*`：表示关系表的所有属性，说明读取全部属性；

  
  **查询所有女生的姓名和出生时间：**

  ```sql
  SELECT SN AS 姓名, SB AS 出生时间
  FROM S
  WHERE SEX='女';
  ```

  `AS`：显示结果中，`SN`和`SB`的属性名名显示**列名**为姓名和出生时间；

  

  **查询选修了课程的学生的学号：**

  ```sql
  SELECT DISTINCT SNO
  FROM SC;
  / 每个学号结果只会出现一次
  ```

  `DISTINCT`：强行删除结果中表中的**重复行**；

  （默认`ALL`不去出重复元组）

  

  :star:**查询学生的学号和学生的年龄：**

  ```sql
  SELECT SNO, SA=datediff(Year,SB,Getdate())+1
  FROM S;
  ```

  `SA`赋于计算学生的年龄后的结果，然后显示；

  ```sql
  datediff(datepart, startdate, enddate);
  / 以datepart指定的方式计算两个日期的差值
  ```
  
  另外一种方法：
  
  ```sql
  SELECT SN, timestampdiff(year, SB, curdate())+1 as SAGE
  FROM S
  WHERE SD='计算机'; # 计算机中学生的年龄
  ```
  
  

****

+ **查询满足条件的元组**：

  1. 运算符

  2. **使用`BETWEEN`查询：查询出生时间在…之间的学生姓名和出生时间：**

  ```sql
  SELECT SN, SB
  FROM S
  WHERE SB BETWEEN '1990-01-01' AND '1991-12-31)'
  ```

  3. **使用`LIKE`查询：**

     `LIKE`用于字符串的比较；

     匹配方式：

     + 字符`_`：代表任意一个**单字符**；
     + 字符`%`：代表长度可为`0`的**任意长**字符串；
     + 所有其他字符只表示自己；

     **查询姓`王`所有学生的学号和姓名**：

     ```sql
     SELECT SNO,SN
     FROM S
     WHERE SN LIKE '王%';
     ```

     **查询姓`李`且姓名为`3`个汉字的学生学号和姓名：**

     ```sql
     SELECT SN
     from s
     where SN like '李__';
     ```

     **查询课程名后缀为`_Design`的课程信息**：

     ```sql
     SELECT *
     FROM C 
     WHERE CN LIKE '%\_Design' ESCAPE'\';
     ```
  
     当字符串中原本含有`_`，需要**转义**：`ESCAPE`表示字符串后面的`_`不再是**通配符**；
  
  4. **使用`IN`查询：**
  
     `IN`：判断一个值是否属于一个集合；
  
     **查询非数学系和计算机系的学生的姓名、学号、所在系：**
  
     ```sql
     SELECT SN,SNO,SD
     FROM S
     WHERE SD NOT IN('数学','计算机');
     ```
  
  5. **使用`NULL`查询**
  
     测试属性值为空？

****

+ **查询结果的排序**：

  DBMS默认以元组在表中的先后顺序输出查询结果；

  格式：

  ```sql
  ORDER BY <目标列> [ASC | DESC] 
  ```

  + `ASC`：升序，（默认值）；

  + `DESC`降序；

  **查询成绩，降序排列：**

  ```sql
  SELECT SNO,GRADE
  FROM SC
  WHERE SNO='C02'
  ORDER BY GRADE DESC;
  ```

  > :warning: 如果某列为`NULL`，则其值为**最小值**；

***

+ 聚集函数

  ```sql
  COUNT(*) # 统计元组个数
  SUM() # 计算一属性列值的总和
  AVG() # 计算一属性列值的平均值
  MAX() # 求一属性列中的最大值
  MIN() # 求一属性列中的最小值
  ```

  > + 使用`DISTINCT`**去除重复值**，默认`ALL`会保留重复值；
  > + 在聚集函数遇到`NULL`时，除了`COUNT()`函数意外都只处理**非空值**；

  **求学生表S中学生的总人数：**

  ```sql
  SELECT COUNT(*)
  FROM S;
  ```

  **求选修了课程的学生人数：**

  ```sql
  SELECT COUNT()
  ```

  